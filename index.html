<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Lompat Tangga - Freminet</title>
    <style>
        body {
            /* HANYA WARNA FALLBACK DAN POSISI TENGAH */
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #333; /* Warna di luar canvas */
        }
        canvas {
            display: block;
            margin: 0 auto;
            border: 5px solid #fff; /* Bingkai Putih */
            /* Canvas tidak transparan lagi, karena dia akan menggambar BG */
            background-color: #000; 
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="400" height="600"></canvas>
    
    <script>
        var canvas = document.getElementById("gameCanvas");
        var ctx = canvas.getContext("2d");
        
        // --- Variabel Gambar ---
        var charImg = new Image();
        charImg.src = "Freminet-removebg-preview.png"; // Karakter
        
        // --- BACKGROUND KEMBALI DI JS ---
        var bgImg = new Image();
        bgImg.src = "unduhan (1).jpg"; // Ganti nama file ini jika perlu!

        // --- Variabel Game State dan Win Condition ---
        var score = 0;
        var WIN_SCORE = 20; 
        var gameState = "running"; 

        // --- Player ---
        var player = {
            x: 175,
            y: 500,
            width: 50,
            height: 50,
            vy: 0,
            gravity: 0.5,
            jumpStrength: -10,
            onGround: false
        };

        // --- Platform/Tangga ---
        var platforms = [];
        function initializePlatforms() {
            platforms = [];
            for (var i = 0; i < 8; i++) {
                platforms.push({
                    x: Math.random() * 320,
                    y: i * 75 + 50,
                    width: 80,
                    height: 15
                });
            }
        }
        initializePlatforms(); 

        // --- Kontrol ---
        var keys = {};
        document.addEventListener("keydown", function(e) { 
            keys[e.key] = true; 
            if ((gameState === "gameOver" || gameState === "win") && e.key === "Enter") {
                resetGame();
            }
        });
        document.addEventListener("keyup", function(e) { keys[e.key] = false; });

        // --- Fungsi Reset Game ---
        function resetGame() {
            player.x = 175;
            player.y = 500;
            player.vy = 0;
            score = 0;
            initializePlatforms();
            gameState = "running";
        }

        // --- Fungsi Draw (Gambar) ---
        function draw() {
            // 1. Gambar Background (SEKARANG MENGGAMBAR BG DI DALAM CANVAS)
            if (bgImg.complete && bgImg.naturalWidth !== 0) {
                // Menggambar BG seukuran CANVAS (400x600)
                ctx.drawImage(bgImg, 0, 0, canvas.width, canvas.height); 
            } else {
                // Fallback warna canvas jika gambar BG gagal dimuat
                ctx.fillStyle = "#87CEEB"; 
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }

            // 2. Gambar Platform/Tangga
            ctx.fillStyle = "#A0522D"; 
            platforms.forEach(function(p) {
                ctx.fillRect(p.x, p.y, p.width, p.height);
            });

            // 3. Gambar Player
            if (charImg.complete && charImg.naturalWidth !== 0) {
                 ctx.drawImage(charImg, player.x, player.y, player.width, player.height);
            } else {
                 // Fallback: Kotak merah jika karakter gagal dimuat
                 ctx.fillStyle = "#FF0000"; 
                 ctx.fillRect(player.x, player.y, player.width, player.height);
            }

            // 4. Gambar Score
            ctx.font = "20px Arial";
            ctx.fillStyle = "#FFF"; 
            ctx.fillText("Score: " + score, 10, 30);
            
            // 5. Gambar Status Game
            if (gameState !== "running") {
                drawGameStateOverlay();
            }
        }
        
        // ... (drawGameStateOverlay dan update sama) ...
        
        function drawGameStateOverlay() {
            ctx.fillStyle = "rgba(0, 0, 0, 0.7)";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.textAlign = "center";
            
            if (gameState === "gameOver") {
                ctx.font = "40px Arial";
                ctx.fillStyle = "#FF4444";
                ctx.fillText("GAME OVER", canvas.width / 2, canvas.height / 2 - 20);
                ctx.font = "20px Arial";
                ctx.fillStyle = "#FFFFFF";
                ctx.fillText("Skor Akhir: " + score, canvas.width / 2, canvas.height / 2 + 20);
                ctx.fillText("Tekan [Enter] untuk Mulai Lagi", canvas.width / 2, canvas.height / 2 + 50);
            } else if (gameState === "win") {
                ctx.font = "40px Arial";
                ctx.fillStyle = "#44FF44";
                ctx.fillText("YOU WIN!", canvas.width / 2, canvas.height / 2 - 20);
                ctx.font = "20px Arial";
                ctx.fillStyle = "#FFFFFF";
                ctx.fillText("Skor Anda: " + score, canvas.width / 2, canvas.height / 2 + 20);
                ctx.fillText("Tekan [Enter] untuk Mulai Lagi", canvas.width / 2, canvas.height / 2 + 50);
            }
            ctx.textAlign = "left"; 
        }

        function update() {
            if (gameState !== "running") return; 

            if (keys["ArrowLeft"]) player.x -= 5;
            if (keys["ArrowRight"]) player.x += 5;

            if (player.x < 0) player.x = 0;
            if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;

            player.vy += player.gravity;
            player.y += player.vy;

            player.onGround = false;
            platforms.forEach(function(p) {
                if (player.vy > 0 &&
                    player.x + player.width > p.x &&
                    player.x < p.x + p.width &&
                    player.y + player.height > p.y &&
                    player.y + player.height < p.y + p.height + player.vy) {
                    player.vy = player.jumpStrength;
                    player.onGround = true;
                    score += 1;
                    
                    if (score >= WIN_SCORE) {
                        gameState = "win";
                    }
                }
            });

            if (player.y < 250) {
                player.y += 5;
                platforms.forEach(function(p) {
                    p.y += 5;
                    if (p.y > canvas.height) {
                        p.y = Math.random() * -40;
                        p.x = Math.random() * 320;
                    }
                });
            }

            if (player.y > canvas.height) {
                gameState = "gameOver";
            }
        }


        // --- Loop Game ---
        function loop() {
            update();
            draw();
            requestAnimationFrame(loop);
        }

        // Pemuatan Aset
        var imagesLoaded = 0;
        var totalImages = 2; 

        function imageLoaded() {
            imagesLoaded++;
            if (imagesLoaded === totalImages) {
                loop(); // Mulai loop setelah KEDUA gambar dimuat
            }
        }

        charImg.onload = imageLoaded;
        bgImg.onload = imageLoaded;
        
        charImg.onerror = function() { 
            console.error("Gagal memuat karakter."); 
            imageLoaded(); 
        };
        bgImg.onerror = function() { 
            console.error("Gagal memuat background."); 
            imageLoaded(); 
        };

    </script>
</body>
</html>
